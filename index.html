<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPv4 Subnet Calculator</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f0f0f0;
            margin: 20px;
            color: #333;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #006633;
            font-size: 24px;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        /* Form Style similar to calculator.net */
        .calc-form {
            background-color: #eeeeee;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .form-label {
            width: 150px;
            font-weight: bold;
            font-size: 14px;
        }

        input[type="text"] {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            width: 200px;
            font-size: 14px;
        }

        select {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 14px;
            background: white;
        }

        .btn-calc {
            background-color: #006633;
            color: white;
            border: none;
            padding: 8px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-calc:hover {
            background-color: #004d26;
        }

        .btn-clear {
            background-color: #888;
            color: white;
            border: none;
            padding: 8px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            margin-left: 10px;
            text-decoration: none;
            display: inline-block;
        }

        /* Results Table Style */
        table.results {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }

        table.results th, table.results td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        table.results th {
            background-color: #f9f9f9;
            width: 30%;
            font-weight: bold;
        }

        .binary {
            font-family: monospace;
            color: #666;
            font-size: 13px;
        }

        .highlight {
            color: #006633;
            font-weight: bold;
        }

        .error {
            color: red;
            font-weight: bold;
            display: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>IPv4 Subnet Calculator</h1>

    <div class="calc-form">
        <div class="form-row">
            <span class="form-label">Indirizzo IP:</span>
            <input type="text" id="ip_address" value="10.100.0.0" placeholder="es. 192.168.1.1">
        </div>
        
        <div class="form-row">
            <span class="form-label">Subnet Mask:</span>
            <select id="cidr">
                </select>
        </div>

        <div class="form-row">
            <span class="form-label"></span>
            <button class="btn-calc" onclick="calculate()">Calcola</button>
            <button class="btn-clear" onclick="resetForm()">Pulisci</button>
        </div>
        <div id="error-msg" class="error">Inserisci un indirizzo IP valido.</div>
    </div>

    <div id="result-container" style="display: block;">
        <h3>Risultati</h3>
        <table class="results">
            <tr>
                <th>Indirizzo IP</th>
                <td id="res-ip">10.100.0.0</td>
            </tr>
            <tr>
                <th>Maschera di Sottorete</th>
                <td>
                    <span id="res-mask">255.255.0.0</span>
                    <br><span class="binary" id="res-mask-bin">11111111.11111111.00000000.00000000</span>
                </td>
            </tr>
            <tr>
                <th>Indirizzo di Rete</th>
                <td>
                    <span id="res-net" class="highlight">10.100.0.0</span>
                    <br><span class="binary" id="res-net-bin">00001010.01100100.00000000.00000000</span>
                </td>
            </tr>
            <tr>
                <th>Range Host Utilizzabili</th>
                <td id="res-range">10.100.0.1 - 10.100.255.254</td>
            </tr>
            <tr>
                <th>Indirizzo di Broadcast</th>
                <td>
                    <span id="res-bcast">10.100.255.255</span>
                    <br><span class="binary" id="res-bcast-bin">00001010.01100100.11111111.11111111</span>
                </td>
            </tr>
            <tr>
                <th>Totale Host</th>
                <td id="res-total">65536</td>
            </tr>
            <tr>
                <th>Host Utilizzabili</th>
                <td id="res-usable" class="highlight">65534</td>
            </tr>
            <tr>
                <th>Wildcard Mask</th>
                <td id="res-wild">0.0.255.255</td>
            </tr>
            <tr>
                <th>Notazione CIDR</th>
                <td id="res-cidr">/16</td>
            </tr>
            <tr>
                <th>Tipo di IP</th>
                <td id="res-class">Private (Class A)</td>
            </tr>
        </table>
    </div>
</div>

<script>
    // Popola il menu a tendina CIDR
    const cidrSelect = document.getElementById('cidr');
    for (let i = 32; i >= 1; i--) {
        let maskLong = -1 << (32 - i);
        let maskStr = longToIp(maskLong);
        let option = document.createElement('option');
        option.value = i;
        option.text = `/${i} - ${maskStr}`;
        if (i === 16) option.selected = true; // Default /16 come da traccia 
        cidrSelect.appendChild(option);
    }

    function calculate() {
        const ipInput = document.getElementById('ip_address').value.trim();
        const cidr = parseInt(document.getElementById('cidr').value);
        const errorMsg = document.getElementById('error-msg');

        if (!validateIp(ipInput)) {
            errorMsg.style.display = 'block';
            return;
        }
        errorMsg.style.display = 'none';

        // Calcoli Core
        const ipLong = ipToLong(ipInput);
        const maskLong = -1 << (32 - cidr);
        const networkLong = (ipLong & maskLong) >>> 0;
        const wildcardLong = (~maskLong) >>> 0;
        const broadcastLong = (networkLong | wildcardLong) >>> 0;
        
        const usableStartLong = (networkLong + 1) >>> 0;
        const usableEndLong = (broadcastLong - 1) >>> 0;
        
        const totalHosts = Math.pow(2, 32 - cidr);
        const usableHosts = (cidr === 32) ? 0 : (cidr === 31) ? 0 : totalHosts - 2;

        // Aggiorna UI
        document.getElementById('res-ip').innerText = ipInput;
        document.getElementById('res-mask').innerText = longToIp(maskLong);
        document.getElementById('res-mask-bin').innerText = toBinary(maskLong);
        
        document.getElementById('res-net').innerText = longToIp(networkLong);
        document.getElementById('res-net-bin').innerText = toBinary(networkLong);
        
        document.getElementById('res-bcast').innerText = longToIp(broadcastLong);
        document.getElementById('res-bcast-bin').innerText = toBinary(broadcastLong);
        
        if (cidr >= 31) {
            document.getElementById('res-range').innerText = "N/A";
        } else {
            document.getElementById('res-range').innerText = longToIp(usableStartLong) + " - " + longToIp(usableEndLong);
        }

        document.getElementById('res-total').innerText = totalHosts.toLocaleString();
        document.getElementById('res-usable').innerText = usableHosts.toLocaleString();
        document.getElementById('res-wild').innerText = longToIp(wildcardLong);
        document.getElementById('res-cidr').innerText = "/" + cidr;
        document.getElementById('res-class').innerText = getIpClass(ipLong);
    }

    function resetForm() {
        document.getElementById('ip_address').value = "10.100.0.0"; // Reset al valore della traccia 
        document.getElementById('cidr').value = "16";
        calculate();
    }

    // Helpers
    function ipToLong(ip) {
        return ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet, 10), 0) >>> 0;
    }

    function longToIp(long) {
        return [
            (long >>> 24) & 255,
            (long >>> 16) & 255,
            (long >>> 8) & 255,
            long & 255
        ].join('.');
    }

    function toBinary(n) {
        let bin = (n >>> 0).toString(2).padStart(32, '0');
        return bin.match(/.{1,8}/g).join('.');
    }

    function validateIp(ip) {
        const regex = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
        return regex.test(ip);
    }

    function getIpClass(ipLong) {
        const firstOctet = (ipLong >>> 24) & 255;
        let type = "Public";
        // Check Private Ranges
        // 10.0.0.0/8
        if (firstOctet === 10) type = "Private";
        // 172.16.0.0/12
        else if (firstOctet === 172 && ((ipLong >>> 16) & 255) >= 16 && ((ipLong >>> 16) & 255) <= 31) type = "Private";
        // 192.168.0.0/16
        else if (firstOctet === 192 && ((ipLong >>> 16) & 255) === 168) type = "Private";
        
        let ipClass = "";
        if (firstOctet >= 1 && firstOctet <= 126) ipClass = "Class A";
        else if (firstOctet >= 128 && firstOctet <= 191) ipClass = "Class B";
        else if (firstOctet >= 192 && firstOctet <= 223) ipClass = "Class C";
        else if (firstOctet >= 224 && firstOctet <= 239) ipClass = "Class D (Multicast)";
        else ipClass = "Class E (Reserved)";

        return `${type} (${ipClass})`;
    }

    // Inizializza calcolo al caricamento
    calculate();
</script>

</body>
</html>
