<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tool IPv4 Unificato</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 2rem;
      background: #f4f4f4;
    }

    h1, h2 {
      text-align: center;
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .section {
      margin-bottom: 2rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }

    input, select, button {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
    }

    button {
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .result {
      background: #eef;
      padding: 1rem;
      border-radius: 4px;
      white-space: pre-wrap;
    }

    .footer {
      text-align: center;
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Tool Unificato IPv4</h1>

    <div class="section">
      <h2>1Ô∏è‚É£ Calcolo Classe IP</h2>
      <label for="ipClass">Inserisci un IP:</label>
      <input type="text" id="ipClass" placeholder="es. 192.168.1.1" />
      <button onclick="generateRandomIP()">üé≤ IP Casuale</button>
      <button onclick="detectClass()">üì° Verifica Classe</button>
      <div class="result" id="classResult"></div>
    </div>

    <div class="section">
      <h2>2Ô∏è‚É£ Calcolo Dettagli Subnetting</h2>
      <label for="ipSubnet">Indirizzo IP:</label>
      <input type="text" id="ipSubnet" placeholder="es. 192.168.1.1" />

      <label for="maskSubnet">Maschera CIDR (es. /24):</label>
      <input type="text" id="maskSubnet" placeholder="/24 o 255.255.255.0" />

      <button onclick="calculateSubnet()">üßÆ Calcola</button>
      <div class="result" id="subnetResult"></div>
    </div>
  </div>

  <div class="footer">
    Tool sviluppato per IPv4 ‚Äì Tutti i diritti riservati ¬© 2025
  </div>

  <script>
    function generateRandomIP() {
      const ip = Array(4).fill().map(() => Math.floor(Math.random() * 256)).join('.');
      document.getElementById('ipClass').value = ip;
    }

    function detectClass() {
      const ip = document.getElementById('ipClass').value.trim();
      const firstOctet = parseInt(ip.split('.')[0]);
      let classe = 'Indeterminata';

      if (isNaN(firstOctet)) {
        document.getElementById('classResult').textContent = '‚ùå IP non valido.';
        return;
      }

      if (firstOctet >= 1 && firstOctet <= 126) classe = 'Classe A';
      else if (firstOctet >= 128 && firstOctet <= 191) classe = 'Classe B';
      else if (firstOctet >= 192 && firstOctet <= 223) classe = 'Classe C';
      else if (firstOctet >= 224 && firstOctet <= 239) classe = 'Classe D (Multicast)';
      else if (firstOctet >= 240 && firstOctet <= 254) classe = 'Classe E (Riservata)';

      document.getElementById('classResult').textContent = `‚úÖ ${ip} appartiene alla ${classe}`;
    }

    function ipToBinary(ip) {
      return ip.split('.').map(octet => parseInt(octet).toString(2).padStart(8, '0')).join('');
    }

    function binaryToIP(bin) {
      return bin.match(/.{1,8}/g).map(b => parseInt(b, 2)).join('.');
    }

    function cidrToMask(cidr) {
      const bits = parseInt(cidr.replace('/', ''));
      return Array(4).fill().map((_, i) => {
        const len = Math.min(8, bits - i * 8);
        return len > 0 ? parseInt('1'.repeat(len).padEnd(8, '0'), 2) : 0;
      }).join('.');
    }

    function calculateSubnet() {
      let ip = document.getElementById('ipSubnet').value.trim();
      let maskInput = document.getElementById('maskSubnet').value.trim();

      if (!ip.match(/^(\d{1,3}\.){3}\d{1,3}$/)) {
        document.getElementById('subnetResult').textContent = '‚ùå IP non valido.';
        return;
      }

      let cidr = 0;
      if (maskInput.startsWith('/')) {
        cidr = parseInt(maskInput.slice(1));
        if (cidr < 1 || cidr > 32) {
          document.getElementById('subnetResult').textContent = '‚ùå CIDR non valido.';
          return;
        }
      } else {
        const parts = maskInput.split('.').map(Number);
        if (parts.length !== 4 || parts.some(n => isNaN(n))) {
          document.getElementById('subnetResult').textContent = '‚ùå Maschera non valida.';
          return;
        }
        const bin = parts.map(n => n.toString(2).padStart(8, '0')).join('');
        cidr = bin.indexOf('0');
        if (bin.slice(cidr).includes('1')) {
          document.getElementById('subnetResult').textContent = '‚ùå Maschera non valida (non contigua).';
          return;
        }
      }

      const ipBin = ipToBinary(ip);
      const netBin = ipBin.slice(0, cidr).padEnd(32, '0');
      const broadcastBin = ipBin.slice(0, cidr).padEnd(32, '1');

      const network = binaryToIP(netBin);
      const broadcast = binaryToIP(broadcastBin);
      const firstHost = binaryToIP(netBin.slice(0, 31) + '1');
      const lastHost = binaryToIP(broadcastBin.slice(0, 31) + '0');
      const hosts = cidr < 31 ? (2 ** (32 - cidr)) - 2 : (cidr === 31 ? 2 : 1);

      const mask = cidrToMask('/' + cidr);

      document.getElementById('subnetResult').textContent = 
        `üßæ Risultati per ${ip}/${cidr}\n\n` +
        `Maschera: ${mask}\n` +
        `Indirizzo di rete: ${network}\n` +
        `Broadcast: ${broadcast}\n` +
        `Primo host: ${firstHost}\n` +
        `Ultimo host: ${lastHost}\n` +
        `Host disponibili: ${hosts}`;
    }
  </script>
</body>
</html>
