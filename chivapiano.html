<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pianificatore di Rete - IPv4 Surviving Tool</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f4f7f6;
            --white: #ffffff;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); color: var(--primary); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: var(--white); padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 10px; }
        .input-group { display: grid; grid-template-columns: 1fr 1fr 150px; gap: 10px; margin-bottom: 20px; }
        input, button { padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
        button { background: var(--accent); color: white; border: none; cursor: pointer; transition: 0.3s; }
        button:hover { background: #2980b9; }
        
        .result-card { background: #eef2f3; padding: 20px; border-radius: 8px; margin-top: 20px; border-left: 5px solid var(--accent); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; }

        /* Grafica della Rete */
        .network-visual { margin-top: 30px; padding: 20px; border: 1px dashed #ccc; border-radius: 10px; text-align: center; background: #fafafa; }
        .router { display: inline-block; width: 60px; height: 60px; background: #34495e; color: white; line-height: 60px; border-radius: 50%; margin-bottom: 20px; position: relative; }
        .router::after { content: 'Router/GW'; position: absolute; bottom: -25px; left: 0; width: 100%; font-size: 12px; color: #333; }
        .nodes-container { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .node { padding: 10px; background: #fff; border: 2px solid var(--accent); border-radius: 5px; font-size: 13px; min-width: 80px; position: relative; }
        .line { height: 20px; width: 2px; background: #bdc3c7; margin: 0 auto; }
    </style>
</head>
<body>

<div class="container">
    <h1>Chi Va Piano (Indirizzamento IPv4)</h1>
    <p>Inserisci l'indirizzo di rete e il numero di host necessari per generare il piano completo.</p>
    
    <div class="input-group">
        <input type="text" id="networkIp" placeholder="Es: 192.168.1.0" value="192.168.1.0">
        <input type="number" id="hostsNeeded" placeholder="Host necessari (es: 25)" value="25">
        <button onclick="generaPiano()">Genera Piano</button>
    </div>

    <div id="output"></div>
</div>

<script>
function getCIDR(hosts) {
    const totalSlots = hosts + 2; // + Gateway/Network e Broadcast
    let bits = 32 - Math.ceil(Math.log2(totalSlots));
    return bits;
}

function ipToLong(ip) {
    return ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet, 10), 0) >>> 0;
}

function longToIp(long) {
    return [(long >>> 24) & 255, (long >>> 16) & 255, (long >>> 8) & 255, long & 255].join('.');
}

function generaPiano() {
    const ipInput = document.getElementById('networkIp').value;
    const hostsNeeded = parseInt(document.getElementById('hostsNeeded').value);
    
    if (!ipInput || isNaN(hostsNeeded)) {
        alert("Inserisci dati validi");
        return;
    }

    const cidr = getCIDR(hostsNeeded);
    const maskLong = (0xFFFFFFFF << (32 - cidr)) >>> 0;
    const netLong = (ipToLong(ipInput) & maskLong) >>> 0;
    const broadcastLong = (netLong | (~maskLong)) >>> 0;
    const totalHosts = Math.pow(2, (32 - cidr)) - 2;

    const piano = {
        rete: longToIp(netLong),
        mask: longToIp(maskLong),
        cidr: cidr,
        gateway: longToIp(netLong + 1),
        primoIp: longToIp(netLong + 2),
        ultimoIp: longToIp(broadcastLong - 1),
        broadcast: longToIp(broadcastLong),
        hostDisponibili: totalHosts
    };

    renderizzaRisultato(piano, hostsNeeded);
}

function renderizzaRisultato(p, richiesti) {
    const html = `
        <div class="result-card">
            <h3>Dettagli Piano di Indirizzamento</h3>
            <table>
                <tr><td>Indirizzo di Rete</td><td><strong>${p.rete} /${p.cidr}</strong></td></tr>
                <tr><td>Subnet Mask</td><td>${p.mask}</td></tr>
                <tr><td>Default Gateway</td><td>${p.gateway}</td></tr>
                <tr><td>Range Host Usabili</td><td>${p.primoIp} - ${p.ultimoIp}</td></tr>
                <tr><td>Broadcast</td><td>${p.broadcast}</td></tr>
                <tr><td>Capacit√† Totale</td><td>${p.hostDisponibili} host (Richiesti: ${richiesti})</td></tr>
            </table>
        </div>

        <div class="network-visual">
            <h4>Schema Logico della Rete</h4>
            <div class="router">üåê</div>
            <div class="line"></div>
            <div class="nodes-container">
                <div class="node"><strong>GW</strong><br>${p.gateway}</div>
                <div class="node">Host 1<br>${p.primoIp}</div>
                <div class="node">...</div>
                <div class="node">Host ${richiesti}<br>...</div>
                <div class="node">Broadcast<br>${p.broadcast}</div>
            </div>
        </div>
    `;
    document.getElementById('output').innerHTML = html;
}
</script>

</body>
</html>
